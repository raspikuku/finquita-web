<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>KuKu's Finquita</title>
    <meta name="description" content="Weather data from KuKu's Finquita.">
    <meta name="author" content="elkuku">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link href='https://fonts.googleapis.com/css?family=Ubuntu|Ubuntu+Mono' rel='stylesheet' type='text/css'>
    <link href="main.css" rel="stylesheet">
</head>
<body>
<noscript><h1>Please activate JavaScript.</h1></noscript>
<header>
    <h1 id="title"></h1>
    <p id="date"></p>
    <p id="stats"></p>
</header>
<main>
    <table>
        <tr>
            <td>
                <h2 id="value"></h2>
                <div id="fixture"></div>
                <p>Temp: <span id="temp"></span> Â°C</p>
                <p>Humid: <span id="humid"></span> %</p>
            </td>
            <td>
                <a id="picLink" href="">
                    <img id="pic" src="" style="width: 640px; height: 480px"/>
                </a>
            </td>
            <td>
                <p>Press: <span id="press"></span> mBar</p>
                <p>Light: <span id="light"></span> lx</p>
            </td>
        </tr>
    </table>

    <iframe width="450" height="260" style="border: 1px solid #cccccc;"
            src="https://thingspeak.com/channels/154597/charts/1?bgcolor=%23ffffff&color=%23d62020&dynamic=true&results=60&title=Temperature&type=line&yaxis=%C2%B0C"></iframe>

    <iframe width="150" height="150" style="border: 0;" src="https://thingspeak.com/apps/plugins/91763"></iframe>

</main>

<footer>
    <p>Developed by <a href="https://github.com/elkuku" target="_blank">elkuku</a></p>
</footer>

<script src="js/jquery-3.1.0.min.js"></script>
<script src="js/jquery-ui.min.js"></script>
<script src="js/finquita.js"></script>
<script src="js/jquery.thermometer.js"></script>

<script>
    function update() {

        $('#date').html(new Date().toLocaleString());

        $.get('https://api.thingspeak.com/channels/154597/feeds.json?results=1', function (data) {
            var entry = data.feeds[0];

            $('#title').html(data.channel.name);
            $('#temp').html(entry.field1);
            $('#humid').html(entry.field2);
            $('#press').html(entry.field3);
            $('#light').html(entry.field4);
        });

        $.get('https://gist.githubusercontent.com/raspikuku/51f792d4e3d07b21ad182e9ee178e9fb/raw', function (data) {
            $('#pic').attr('src', data + '&dl=1');
            $('#picLink').attr('href', data);
        });
    }
    update();
    setInterval(update, 10000);
</script>

<script type="text/javascript">
    $(document).ready( function() {
        // http://stackoverflow.com/questions/5560248/programmatically-lighten-or-darken-a-hex-color-or-rgb-and-blend-colors
        function blendColors(c0, c1, p) {
            var f=parseInt(c0.slice(1),16),t=parseInt(c1.slice(1),16),R1=f>>16,G1=f>>8&0x00FF,B1=f&0x0000FF,R2=t>>16,G2=t>>8&0x00FF,B2=t&0x0000FF;
            return "#"+(0x1000000+(Math.round((R2-R1)*p)+R1)*0x10000+(Math.round((G2-G1)*p)+G1)*0x100+(Math.round((B2-B1)*p)+B1)).toString(16).slice(1);
        }

        $('#fixture').thermometer( {
            startValue: 0,
            height: 700,
            width: "100%",
            bottomText: "Cold",
            topText: "Hot",
            animationSpeed: 300,
            maxValue: 8,
            minValue: 0,
            liquidColour: function( value ) {
                return blendColors("#ff7700","#ff0000", value / 8);
            },
            valueChanged: function(value) {
                $('#value').text(value.toFixed(2));
            }
        });

        window.setInterval( function() {
            var m = Math.random() * 8;
            $('#fixture').thermometer( 'setValue', m );
        }, 2000 );
    } );
</script>
</body>
</html>
